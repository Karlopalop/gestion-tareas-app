<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">Dashboard</h1>  
      <p class="dashboard-subtitle" *ngIf="usuarioLogueado">
        Resumen de productividad de <strong>{{ usuarioLogueado }}</strong>
      </p>
      <p class="dashboard-subtitle" *ngIf="!usuarioLogueado">
        Resumen de tu productividad
      </p>
    </div>
    <button class="refresh-btn" (click)="recargar()" [disabled]="isLoading">
      <span class="refresh-icon" [class.spinning]="isLoading">🔄</span>
      <span class="refresh-text">{{ isLoading ? 'Actualizando...' : 'Actualizar' }}</span>
    </button>
  </div>

  <!-- Mensaje de Bienvenida -->
  <div *ngIf="!isLoading && usuarioLogueado" class="welcome-banner">
    <div class="welcome-content">
      <span class="welcome-icon">👋</span>
      <div class="welcome-text">
        <h3>{{ mensajeBienvenida }}</h3>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-banner">
    <span class="error-icon">⚠️</span>
    {{ errorMessage }}
    <button class="retry-btn" (click)="recargar()">Reintentar</button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Cargando tu dashboard personalizado...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && !errorMessage" class="dashboard-content">
    
    <!-- Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-background total-bg"></div>
        <div class="stat-content">
          <div class="stat-icon">📋</div>
          <div class="stat-info">
            <h3 class="stat-title">Total Tareas</h3>
            <span class="stat-number">{{ totalTareas }}</span>
            <span class="stat-trend">Todas las actividades</span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-background pending-bg"></div>
        <div class="stat-content">
          <div class="stat-icon">⏳</div>
          <div class="stat-info">
            <h3 class="stat-title">Pendientes</h3>
            <span class="stat-number">{{ tareasPendientes }}</span>
            <span class="stat-trend">Por completar</span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-background completed-bg"></div>
        <div class="stat-content">
          <div class="stat-icon">✅</div>
          <div class="stat-info">
            <h3 class="stat-title">Completadas</h3>
            <span class="stat-number">{{ tareasCompletadas }}</span>
            <div class="stat-details">
              <span class="stat-percentage">{{ getPorcentajeCompletadas() }}%</span>
              <span class="stat-label">del total</span>
            </div>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-background upcoming-bg"></div>
        <div class="stat-content">
          <div class="stat-icon">📅</div>
          <div class="stat-info">
            <h3 class="stat-title">Próximas</h3>
            <span class="stat-number">{{ tareasProximas }}</span>
            <span class="stat-trend">Vencen pronto</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Section -->
    <div class="progress-section" *ngIf="hayTareas">
      <div class="section-header">
        <h2 class="section-title">📈 Progreso General</h2>
        <span class="progress-percentage">{{ getPorcentajeCompletadas() }}%</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <div 
            class="progress-fill" 
            [style.width.%]="getPorcentajeCompletadas()">
            <div class="progress-glow"></div>
          </div>
        </div>
        <div class="progress-labels">
          <span>0%</span>
          <span>50%</span>
          <span>100%</span>
        </div>
      </div>
    </div>

    <!-- Sin Tareas State -->
    <div *ngIf="!hayTareas" class="empty-dashboard">
      <div class="empty-content">
        <div class="empty-icon">📊</div>
        <h2>¡Comienza a ser productivo!</h2>
        <p>Aún no tienes tareas. Crea tu primera tarea para ver tu progreso aquí.</p>
        <a routerLink="/tareas" class="primary-button">
          <span class="button-icon">➕</span>
          Crear Mi Primera Tarea
        </a>
      </div>
    </div>

    <!-- Recent Tasks & Quick Actions -->
    <div *ngIf="hayTareas" class="actions-grid">
      <!-- Recent Tasks -->
      <div class="recent-tasks">
        <div class="section-header">
          <h2 class="section-title">📝 Tareas Recientes</h2>
          <a routerLink="/tareas" class="view-all-link">
            Ver todas
            <span class="link-arrow">→</span>
          </a>
        </div>
        
        <div *ngIf="!hayTareasRecientes" class="empty-state">
          <div class="empty-icon">📭</div>
          <h3>No hay tareas recientes</h3>
          <p>Las tareas que crees aparecerán aquí</p>
        </div>

        <div *ngIf="hayTareasRecientes" class="tasks-list">
          <div *ngFor="let tarea of tareasRecientes" class="task-item" [class.completed]="tarea.completada">
            <div class="task-checkbox">
              <div class="checkbox" [class.checked]="tarea.completada">
                <span *ngIf="tarea.completada" class="check-icon">✓</span>
              </div>
            </div>
            <div class="task-content">
              <div class="task-header">
                <h4 class="task-title" [class.completed]="tarea.completada">{{ tarea.titulo }}</h4>
                <span class="task-priority" [class]="'priority-' + tarea.prioridad.toLowerCase()">
                  {{ tarea.prioridad }}
                </span>
              </div>
              <div class="task-meta">
                <span class="task-date">
                  <span class="meta-icon">📅</span>
                  {{ tarea.fechaVencimiento ? (tarea.fechaVencimiento | date:'dd/MM/yyyy') : 'Sin fecha' }}
                </span>
                <!-- ✅ CORREGIDO: Usar getNombreCategoria(tarea) en lugar de getNombreCategoria(tarea.categoriaId) -->
                <span class="task-category" [style.color]="getColorCategoria(tarea)">
                  <span class="category-dot" [style.background-color]="getColorCategoria(tarea)"></span>
                  {{ getNombreCategoria(tarea) }}
                </span>
              </div>
              <!-- ✅ NUEVO: Estado de la tarea -->
              <div class="task-status">
                <span class="status-badge" [class.completed]="tarea.completada">
                  {{ tarea.completada ? '✅ Completada' : '⏳ Pendiente' }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <h2 class="section-title">🚀 Acciones Rápidas</h2>
        <div class="actions-list">
          <a routerLink="/tareas" class="action-item new-task">
            <div class="action-icon">➕</div>
            <div class="action-content">
              <h3>Nueva Tarea</h3>
              <p>Crea una nueva tarea</p>
            </div>
            <span class="action-arrow">→</span>
          </a>

          <a routerLink="/tareas" class="action-item view-all">
            <div class="action-icon">📋</div>
            <div class="action-content">
              <h3>Ver Todas</h3>
              <p>Gestiona todas las tareas</p>
            </div>
            <span class="action-arrow">→</span>
          </a>

          <div class="action-item refresh" (click)="recargar()">
            <div class="action-icon">🔄</div>
            <div class="action-content">
              <h3>Actualizar</h3>
              <p>Actualizar datos</p>
            </div>
            <span class="action-arrow">↻</span>
          </div>

          <!-- ✅ NUEVO: Acción para crear categoría -->
          <a routerLink="/categorias" class="action-item categories" *ngIf="categorias.length === 0">
            <div class="action-icon">🏷️</div>
            <div class="action-content">
              <h3>Crear Categorías</h3>
              <p>Organiza tus tareas</p>
            </div>
            <span class="action-arrow">→</span>
          </a>
        </div>

        <!-- ✅ NUEVO: Resumen de categorías -->
        <div class="categories-summary" *ngIf="categorias.length > 0">
          <h3 class="summary-title">🏷️ Tus Categorías</h3>
          <div class="categories-list">
            <div *ngFor="let categoria of categorias.slice(0, 3)" class="category-item">
              <span class="category-color" [style.background-color]="categoria.color"></span>
              <span class="category-name">{{ categoria.nombre }}</span>
            </div>
            <div *ngIf="categorias.length > 3" class="category-more">
              +{{ categorias.length - 3 }} más
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>